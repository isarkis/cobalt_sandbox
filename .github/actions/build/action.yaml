name: Build Cobalt
description: Builds Cobalt targets
runs:
  using: "composite"
  steps:
    - name: Configure Environment
      shell: bash
      run: |
        echo "PYTHONPATH=$GITHUB_WORKSPACE" >> $GITHUB_ENV
    - name: Build
      run: |
        set -x
        # GitHub Runners have home set to /github/home.
        if [ -d /root/starboard-toolchains ]; then
          ln -s /root/starboard-toolchains /github/home/starboard-toolchains
        fi
        BUILD_TARGET=all
        if [[ "${{matrix.config}}" =~ ^(qa|gold)$ ]]; then
          BUILD_TARGET='cobalt_deploy app_launcher_zip'
        fi
        $GITHUB_WORKSPACE/cobalt/build/gyp_cobalt -v -C ${{ matrix.config }} ${{ matrix.platform }}
        ninja -v -C ${GITHUB_WORKSPACE}/out/${{matrix.platform}}_${{matrix.config}} ${BUILD_TARGET}
      shell: bash
